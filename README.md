## Описание
Плагин платформы Алёна для отслеживания ключевой фразы в аудиопотоке на основе [Vosk](https://alphacephei.com/vosk/).

## Установка

Установка из каталога с исходными кодами:

`pip install -e .`

## Настройка

### Быстрая настройка

Для подключения плагина необходимо в раздел `hotwords` файла конфигурации `alena.conf` добавить: 

```json
  "listener": {
    "wake_word": "алёна"
  },
  "алёна": {
    "hey_computer": {
        "module": "alena-plugin-hotword-vosk",
    }
  }
```
заменив `алёна` на ключевое слово (фразу).

### Одно ключевое слово

Некоторые слова трудны для детекции, особенно если они отсутствуют в языковой модели.
По умолчанию плагин будет отслеживать ключевое слово (фразу), но она может быть
сконфигурирована несколькими способами:  

- `model`- полный путь до модели `vosk`, опционально, будет загружено автоматически
- `lang` - код языка для модели, опционально, если не задан, будет использоваться глобальное значение (заданное в настройках `alena.conf`). Используется для загрузки модели. 
- `debug` - если установлено, выводит отладочную информацию.
- `rule` - правило сопоставления с ключевым словом (см. ниже)
- `time_between_checks` - продолжительность времени между распознаванием, значение между 0.2 и 3.0
- `full_vocab` - использоавть ли полный словарь при распознавании, если false (по умолчанию), `vosk` используется в режиме поиска ключевого слова 
- `samples` - список примеров правил, опционально, по умолчанию использует поиск ключевого слова.

```json
  "listener": {
    "wake_word": "алёна"
  },
  "hotwords": {
    "алёна": {
        "module": "alena-plugin-hotword-vosk",
        "full_vocab": true,
        "rule": "equals",
        "debug": true,
        "samples": ["алёна", "алё на", "олени"],
        "model_folder": "/home/ab/Downloads/vosk-model-small-ru-0.22",
        "time_between_checks": 0.6
    }
  }
```

#### Правила сопоставления с ключевым словом

Можно использовать несколько правил для детекции ключевого слова

- `contains` - если транскрипция содержит любой из предоставленных примеров (`samples`)
- `equals` - если транскрипция точно соответствует любому из предоставленных примеров
- `starts` - если транскрипция начинается с любого из предоставленных примеров
- `ends` - если транскрипция завершается любым из предоставленных примеров
- `fuzzy` - нечеткое соответствие транскрипции предоставленным примерам

Для более точной настройки распознавания рекомендуется в настройках включить режим `"debug": true`, отслеживая логи с указанием того, что было распознано, и выполнить настройку правил и примеров.

Каждая ключевая фраза (слово) должно умещаться в 3 сек, что соответствует продолжительности аудиозаписи, которая может быть за один раз рассмотрено моделью.

Можно улучшить качество распознавания путем настройки параметра `time_between_checks`. Малые значения ухудшают скорость распознавания, высокие значения снижают точность, рекомендованное значение составляет 1.0.

При установке `full_vocab` перед применением правил распознавания ключевого слова (фразы) выполняется транскрипция всех известных слов. По умолчанию установлено значение `false`, и плагин изет только примеры ключевых слов. В зависимости от ключевых слов это может как улучшить, так и ухудшить качество распознавания.    
